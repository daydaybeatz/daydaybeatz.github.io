@stats
health:100
attack:5
defense:2
gold:10
reputation:0

@inventory
weapon_knife
potion_small
torch

@flags
visited_courtyard:false
wolves_cleared:false
cellar_purified:false
bandits_dealt:false
lysa_hidden:false
vault_unsealed:false

@quests
missing_traps
water_runs_dark
debt_to_bandits
the_runaway
stone_beneath_roots

@enemy wolf
health:20
attack:5
defense:1

@enemy bandit
health:30
attack:7
defense:2

@enemy corrupted
health:45
attack:9
defense:3

@combat wolves_river
enemy:wolf
enemy:wolf
fleeable:true

on_win:
* flag(wolves_cleared,true)
* quest(missing_traps,complete)
* item(weapon_hunters_bow)
* set(gold,+5)
* result(The wolves scatter. The traps are safe again.)
* room(riverside)

on_lose:
* result(The wolves drive you back, wounded.)
* room(courtyard)

@combat bandit_fight
enemy:bandit
enemy:bandit
fleeable:true

on_win:
* flag(bandits_dealt,true)
* quest(debt_to_bandits,complete)
* item(armor_heavy_boots)
* set(gold,+8)
* result(The bandits flee into the hills.)
* room(broken_hills)

on_lose:
* result(The bandits leave you bruised and robbed.)
* set(gold,-3)
* room(courtyard)

@combat corrupted_shrine
enemy:corrupted
fleeable:false

on_win:
* set(reputation,+1)
* result(The corruption burns away.)
* room(courtyard)

on_lose:
* lose

@room courtyard
Brookhaven Crossing opens before you.
A stone well rests near the center.
A shrine flickers dimly.
A bridge gate leads outward.

!enter
* if(!flag:visited_courtyard) flag(visited_courtyard,true)
* result(The village feels calm, but tense.)

- Speak with Elda
* room(elda)

- Visit Marn’s trade post
* room(marn)

- Check the notice board
* room(notice)

- Head to Riverside Hamlet
* room(riverside)

- Enter Old Growth Woods
* room(woods)

- Climb toward Broken Hills
* room(broken_hills)

- Pray at the shrine (attempts:2)
!chance
* 70% result(The air feels heavy.)
* 30% combat(corrupted_shrine)

@room notice
The board is cluttered with worn postings.

- Accept “Missing Traps”
* quest(missing_traps,start,Clear wolves near the river.)
* result(Rook marked the river on your map.)

- Accept “Water Runs Dark”
* quest(water_runs_dark,start,Investigate the flooded cellar.)
* result(The cellar lies beneath the old shack.)

- Accept “Debt to Bandits”
* quest(debt_to_bandits,start,Deal with bandits in the hills.)

- Accept “The Runaway”
* quest(the_runaway,start,Find Lysa near the woods.)

- Step away
* room(courtyard)

@npc elda
Elda watches you closely.

- Ask about the village
* result(Brookhaven survives by balance, not truth.)

- Ask about the woods
* result(The roots run deep. Best not disturb them.)

- Press her for answers (attempts:1)
* if(reputation>=1) result(Some doors stay buried for a reason.)
* if(reputation<1) result(She refuses to answer.)

- Leave
* room(courtyard)

@npc marn
Marn grins from behind his stall.

- Buy supplies
* result(Potions, tools, and rumors all cost extra these days.)

- Sell pelts
* if(flag:wolves_cleared) set(gold,+6)
* result(Marn counts out the coins.)

- Ask about rumors
* result(Bandits, beasts, and worse under the trees.)

- Leave
* room(courtyard)

@room riverside
Water flows past a small hamlet.
A mill creaks slowly.

!enter
* result(The river smells faintly of rot.)

- Inspect the riverbank (attempts:3)
!chance
* 60% combat(wolves_river)
* 40% result(Tracks fade into the mud.)

- Visit the abandoned shack
* room(shack)

- Return to the crossing
* room(courtyard)

@room shack
The shack smells of rot and damp earth.

- Search inside (attempts:2)
!chance
* 50% set(health,-10)
* 50% result(Nothing but mold and stagnant water.)

- Descend into the flooded cellar
* if(!flag:cellar_purified) result(The water is dark and foul.)
* if(!flag:cellar_purified) flag(cellar_purified,true)
* if(!flag:cellar_purified) quest(water_runs_dark,complete)

- Leave the shack
* room(riverside)

@room woods
Ancient trees loom overhead.

!enter
* result(The forest feels watchful.)

- Search for Lysa
* room(lysa)

- Approach the fallen watchtower
* room(watchtower)

- Return
* room(courtyard)

@npc lysa
Lysa steps back nervously.

- Convince her to return
* set(reputation,+1)
* quest(the_runaway,complete)
* result(She agrees to return home.)
* room(courtyard)

- Help her hide
* flag(lysa_hidden,true)
* set(reputation,-1)
* quest(the_runaway,complete)
* result(She disappears deeper into the woods.)
* room(courtyard)

- Leave her be
* room(woods)

@room watchtower
Roots twist through broken stone.

!enter
* result(The roots grip something beneath the soil.)

- Examine the roots
* if(flag:vault_unsealed) result(The vault stands open.)
* if(!flag:vault_unsealed) result(Something lies buried here.)

- Try to unseal the stone (attempts:2)
* if(reputation>=1) flag(vault_unsealed,true)
* if(reputation>=1) quest(stone_beneath_roots,complete)
* if(reputation>=1) result(The stone grinds open.)
* if(reputation>=1) room(vault)
* if(reputation<1) result(The stone won’t budge.)

- Step away
* room(woods)

@room broken_hills
Wind howls across shattered rock.

- Approach the bandit lookout
!chance
* 50% combat(bandit_fight)
* 50% result(The lookout is empty.)

- Pay off the bandits
* if(gold>=10) set(gold,-10)
* if(gold>=10) flag(bandits_dealt,true)
* if(gold>=10) quest(debt_to_bandits,complete)
* if(gold>=10) result(The bandits leave you alone.)
* if(gold<10) result(Not enough gold.)

- Return
* room(courtyard)

@room vault
Ancient machinery hums beneath twisted roots.
The truth of Brookhaven lies below.

!enter
* result(The vault doors seal behind you.)

- Step into the depths
* win
